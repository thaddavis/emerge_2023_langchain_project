# TLDR
"""LengthBased ExampleSelector"""

from langchain import OpenAI
from langchain.prompts import PromptTemplate
from langchain.prompts import FewShotPromptTemplate
from langchain.prompts.example_selector import LengthBasedExampleSelector

# These are a lot of examples of a pretend task of creating antonyms.
examples = [
    {"input": "happy", "output": "sad"},
    {"input": "tall", "output": "short"},
    {"input": "energetic", "output": "lethargic"},
    {"input": "sunny", "output": "gloomy"},
    {"input": "windy", "output": "calm"},
]

def main():
    example_prompt = PromptTemplate(
        input_variables=["input", "output"],
        template="Input: {input}\nOutput: {output}",
    )
    example_selector = LengthBasedExampleSelector(
        # These are the examples it has available to choose from.
        examples=examples, 
        # This is the PromptTemplate being used to format the examples.
        example_prompt=example_prompt, 
        # This is the maximum length that the formatted examples should be.
        # Length is measured by the get_text_length function below.
        max_length=25,
        # This is the function used to get the length of a string, which is used
        # to determine which examples to include. It is commented out because
        # it is provided as a default value if none is specified.
        # get_text_length: Callable[[str], int] = lambda x: len(re.split("\n| ", x))
    )
    dynamic_prompt = FewShotPromptTemplate(
        # We provide an ExampleSelector instead of examples.
        example_selector=example_selector,
        example_prompt=example_prompt,
        prefix="Give the antonym of every input",
        suffix="Input: {adjective}\nOutput:", 
        input_variables=["adjective"],
    )

    # An example with small input, so it selects all examples.
    print(dynamic_prompt.format(adjective="big"))

    print('--- --- --- --- ---')

    # An example with long input, so it selects only one example.
    long_string = "big and huge and massive and large and gigantic and tall and much much much much much bigger than everything else"
    print(dynamic_prompt.format(adjective=long_string))

    print('--- --- --- --- ---')

    # You can add an example to an example selector as well.
    new_example = {"input": "big", "output": "small"}
    dynamic_prompt.example_selector.add_example(new_example)
    print(dynamic_prompt.format(adjective="enthusiastic"))

    llm = OpenAI(model_name="text-ada-001", n=2, best_of=2)
    res = llm(dynamic_prompt.format(adjective="enthusiastic"))

    print(res)